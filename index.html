<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Popup Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    #popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 20px 30px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      border-radius: 8px;
      z-index: 1000;
    }
    #overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 999;
    }
    button {
      padding: 8px 16px;
      font-size: 16px;
      border: none;
      background-color: #007BFF;
      color: white;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>

<div id="overlay"></div>
 <p>Redirecting you to the app in 3 seconds...test3</p>
<div id="popup">
  <button id="openBtn">Open AppStore</button>
</div>

<script>
    
  const iosUrl = "https://apps.apple.com/app/id1138218678";
    
  const suffix = getQueryParam("ref") || "default";
  const encodedDeeplink = encodeURIComponent(suffix);
  const suf_src = getQueryParam("src") || "";
  const encodeSrc = encodeURIComponent(suf_src);
  const androidUrl = `intent://home#Intent;scheme=thecoffeehouse;package=com.thecoffeehouse.guestapp;S.deeplink=${encodedDeeplink};S.src=${encodeSrc};end;`;
  const fallbackUrl = "https://yourwebsite.com";
  
  // Show the popup after 2 seconds
  window.onload = function() {
     setTimeout(() => {
        const ua = navigator.userAgent || navigator.vendor || window.opera;

        if (/android/i.test(ua)) {
          
          window.location.href = androidUrl;
          
        } else if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) {
          
           // const now = Date.now();

          // Try to open the app
          // window.location = "tch://";
          setTimeout(function(){
            document.getElementById('popup').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
          },5000);

          // After 2 seconds, check if the user is still on the page
          // setTimeout(() => {
          //   const elapsed = Date.now() - now;

          //   if (document.visibilityState === "visible" && elapsed > 1500) {
          //     document.getElementById("popup").style.display = "flex";
          //   }
          // }, 2000);
          
        } else {
          window.location.href = fallbackUrl;
        }
      }, 3000);
    };

    // setTimeout(() => {
    //    const ua = navigator.userAgent || navigator.vendor || window.opera;
    //     if (/android/i.test(ua)) {
    //       window.location.href = androidUrl;
    //     } else if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) {
    //       setTimeout(function(){
    //   document.getElementById('popup').style.display = 'block';
    //   document.getElementById('overlay').style.display = 'block';
    //       },5000);
    //     } else {
    //       window.location.href = fallbackUrl;
    //     }
    // }, 2000);
  };

  function openAppStore() {
      window.location.href = iosUrl; // your app store link
  // const debug = document.getElementById("debug-url");
  // debug.textContent = "Redirecting to: " + iosUrl;
    }

  // Optional: handle "Open" button click
  document.getElementById('openBtn').onclick = function() {
   openAppStore();
  };
</script>

</body>
</html>




